"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[956],{1804:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"persistence","title":"Persistence Configuration","description":"SAM requires persistent storage for session data and artifacts. This page covers all persistence-related configuration options.","source":"@site/docs/persistence.md","sourceDirName":".","slug":"/persistence","permalink":"/solace-agent-mesh-helm-quickstart/docs/persistence","draft":false,"unlisted":false,"editUrl":"https://github.com/SolaceProducts/solace-agent-mesh-helm-quickstart/edit/main/docs/persistence.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Persistence Configuration"},"sidebar":"tutorialSidebar","previous":{"title":"Network Configuration","permalink":"/solace-agent-mesh-helm-quickstart/docs/network-configuration"},"next":{"title":"Standalone Agent Deployment","permalink":"/solace-agent-mesh-helm-quickstart/docs/standalone-agent-deployment"}}');var r=s(4848),t=s(8453);const a={sidebar_position:3,title:"Persistence Configuration"},c="Persistence Configuration",o={},l=[{value:"Overview",id:"overview",level:2},{value:"S3 Bucket Configuration Details",id:"s3-bucket-configuration-details",level:3},{value:"Option 1: Bundled Persistence (Dev/POC Only)",id:"option-1-bundled-persistence-devpoc-only",level:2},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Image Registry Configuration",id:"image-registry-configuration",level:3},{value:"Using Solace&#39;s Private GCR Registry",id:"using-solaces-private-gcr-registry",level:4},{value:"Custom or Self-Managed Images",id:"custom-or-self-managed-images",level:4},{value:"Storage Class Configuration",id:"storage-class-configuration",level:3},{value:"Important Caveats",id:"important-caveats",level:3},{value:"Option 2: External Persistence (Production Recommended)",id:"option-2-external-persistence-production-recommended",level:2},{value:"Database Requirements",id:"database-requirements",level:3},{value:"Basic External Configuration",id:"basic-external-configuration",level:3},{value:"Provider-Specific Examples",id:"provider-specific-examples",level:3},{value:"Supabase with Connection Pooler",id:"supabase-with-connection-pooler",level:4},{value:"AWS RDS + S3",id:"aws-rds--s3",level:4},{value:"NeonDB",id:"neondb",level:4},{value:"AWS S3 Bucket Setup and Policy Requirements",id:"aws-s3-bucket-setup-and-policy-requirements",level:3},{value:"Connector Specs Bucket: Public Read Policy",id:"connector-specs-bucket-public-read-policy",level:4},{value:"Important Security Notes",id:"important-security-notes",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Init Container Stuck in Pending/CrashLoopBackOff",id:"init-container-stuck-in-pendingcrashloopbackoff",level:3},{value:"PVC Stuck in Pending",id:"pvc-stuck-in-pending",level:3},{value:"Docker Hub Rate Limit Errors",id:"docker-hub-rate-limit-errors",level:3}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"persistence-configuration",children:"Persistence Configuration"})}),"\n",(0,r.jsx)(n.p,{children:"SAM requires persistent storage for session data and artifacts. This page covers all persistence-related configuration options."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"SAM uses two types of persistent storage:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL Database"}),": Stores session metadata, user data, and application state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"S3-Compatible Storage"}),": Stores artifacts, files, and other binary data in two separate buckets:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Artifacts bucket"}),": Stores workflow artifacts and temporary files (fully private)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connector specs bucket"}),": Stores OpenAPI connector specification files (public read access, authenticated write only)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"s3-bucket-configuration-details",children:"S3 Bucket Configuration Details"}),"\n",(0,r.jsxs)(n.p,{children:["SAM requires ",(0,r.jsx)(n.strong,{children:"two separate S3 buckets"})," with different access requirements:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Bucket Type"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Access Requirements"}),(0,r.jsx)(n.th,{children:"Features Enabled"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Artifacts"})}),(0,r.jsx)(n.td,{children:"Workflow artifacts, temporary files"}),(0,r.jsx)(n.td,{children:"Fully private (authenticated read/write only)"}),(0,r.jsx)(n.td,{children:"Core workflow functionality"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Connector Specs"})}),(0,r.jsx)(n.td,{children:"OpenAPI specification files"}),(0,r.jsx)(n.td,{children:"Public read, authenticated write"}),(0,r.jsx)(n.td,{children:"OpenAPI Connector feature for automatic REST API integrations"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why two buckets?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Different lifecycle and access patterns: artifacts are temporary workflow data, while connector specs are long-lived infrastructure files"}),"\n",(0,r.jsx)(n.li,{children:"Security isolation: agents must download connector specs at startup without authentication, but workflow artifacts must remain private"}),"\n",(0,r.jsx)(n.li,{children:"Critical infrastructure: agents cannot start without access to connector specification files"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can choose between two persistence strategies:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Strategy"}),(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Components"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Bundled Persistence"})}),(0,r.jsx)(n.td,{children:"Development, demos, POC"}),(0,r.jsx)(n.td,{children:"In-cluster PostgreSQL + SeaweedFS"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"External Persistence"})}),(0,r.jsx)(n.td,{children:"Production deployments"}),(0,r.jsx)(n.td,{children:"Managed PostgreSQL + S3 (e.g., AWS RDS, Supabase, NeonDB)"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"option-1-bundled-persistence-devpoc-only",children:"Option 1: Bundled Persistence (Dev/POC Only)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Not recommended for production."})," The chart can deploy single-instance PostgreSQL and SeaweedFS for quick start, demos, and proof-of-concept deployments."]}),"\n",(0,r.jsx)(n.p,{children:"The bundled SeaweedFS is automatically configured with both required buckets and appropriate security:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Artifacts Bucket"})," (",(0,r.jsx)(n.code,{children:"{namespaceId}"}),"):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fully private - authenticated read/write only"}),"\n",(0,r.jsx)(n.li,{children:"No anonymous access"}),"\n",(0,r.jsx)(n.li,{children:"Stores temporary workflow artifacts"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Connector Specs Bucket"})," (",(0,r.jsx)(n.code,{children:"{namespaceId}-connector-specs"}),"):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Authenticated write access (SAM service only)"}),"\n",(0,r.jsx)(n.li,{children:"Anonymous/public read access (required for agents to download OpenAPI specifications)"}),"\n",(0,r.jsx)(n.li,{children:"Stores critical infrastructure files needed for agent startup"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'global:\n  persistence:\n    enabled: true\n    namespaceId: "my-sam-instance"  # Must be unique per SAM installation\n'})}),"\n",(0,r.jsx)(n.admonition,{title:"Upgrading from \u22641.1.0?",type:"tip",children:(0,r.jsxs)(n.p,{children:["If you have an existing bundled persistence deployment from chart version \u22641.1.0, a one-time migration is required. See ",(0,r.jsx)(n.a,{href:"/#bundled-persistence-vct-labels-upgrading-from-110",children:"Bundled Persistence VCT Labels"})," in the Upgrading guide."]})}),"\n",(0,r.jsx)(n.h3,{id:"image-registry-configuration",children:"Image Registry Configuration"}),"\n",(0,r.jsx)(n.p,{children:"By default, the bundled persistence components pull images from Docker Hub:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["PostgreSQL: ",(0,r.jsx)(n.code,{children:"postgres:18.0"})]}),"\n",(0,r.jsxs)(n.li,{children:["SeaweedFS: ",(0,r.jsx)(n.code,{children:"chrislusf/seaweedfs:3.97"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"using-solaces-private-gcr-registry",children:"Using Solace's Private GCR Registry"}),"\n",(0,r.jsx)(n.p,{children:"To avoid Docker Hub rate limits or when deploying in air-gapped environments, you can use Solace's private GCR registry. When using any of Solace's GCR registries, you must specify GCR-specific image tags:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'global:\n  imageRegistry: gcr.io/gcp-maas-prod\n  persistence:\n    enabled: true\n    namespaceId: "my-sam-instance"\n\nsamDeployment:\n  imagePullSecret: "your-image-pull-secret"  # Required - see Step 2 in Getting Started\n\npersistence-layer:\n  postgresql:\n    image:\n      tag: "18.0-trixie"  # Required for GCR (Docker Hub default: "18.0")\n  seaweedfs:\n    image:\n      tag: "3.97-compliant"  # Required for GCR (Docker Hub default: "3.97")\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": The image pull secret is required for accessing Solace's private GCR registry. See ",(0,r.jsx)(n.a,{href:"/#step-2-configure-image-pull-secret",children:"Configure Image Pull Secret"})," in the Getting Started guide."]}),"\n"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Docker Hub Tag"}),(0,r.jsx)(n.th,{children:"GCR Tag"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PostgreSQL"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"18.0"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"18.0-trixie"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SeaweedFS"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3.97"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3.97-compliant"})})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"custom-or-self-managed-images",children:"Custom or Self-Managed Images"}),"\n",(0,r.jsx)(n.p,{children:"For advanced use cases where you need to use custom images (e.g., self-hosted registries, modified images, or air-gapped environments), you can override the full image configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'persistence-layer:\n  postgresql:\n    image:\n      registry: "my-registry.example.com"  # Custom registry (overrides global.imageRegistry)\n      repository: "my-org/custom-postgres" # Custom image name (default: "postgres")\n      tag: "18.0-custom"                   # Custom tag (default: "18.0")\n  seaweedfs:\n    image:\n      registry: "my-registry.example.com"\n      repository: "my-org/custom-seaweedfs" # Default: "chrislusf/seaweedfs"\n      tag: "3.97-custom"                    # Default: "3.97"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Image Configuration Precedence:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"persistence-layer.[postgresql|seaweedfs].image.registry"})," (if set) takes precedence over ",(0,r.jsx)(n.code,{children:"global.imageRegistry"})]}),"\n",(0,r.jsx)(n.li,{children:"If neither registry is set, images pull from Docker Hub by default"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"repository"})," and ",(0,r.jsx)(n.code,{children:"tag"})," are always component-specific and can be overridden independently"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"storage-class-configuration",children:"Storage Class Configuration"}),"\n",(0,r.jsx)(n.p,{children:"By default, the bundled persistence uses the cluster's default storage class. To specify a custom storage class:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'persistence-layer:\n  postgresql:\n    persistence:\n      storageClassName: "gp3"  # e.g., gp3 for AWS EBS\n      size: "10Gi"  # Default: 10Gi\n  seaweedfs:\n    persistence:\n      storageClassName: "gp3"\n      size: "20Gi"  # Default: 20Gi\n'})}),"\n",(0,r.jsx)(n.h3,{id:"important-caveats",children:"Important Caveats"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"PVCs persist after uninstall"}),": When you run ",(0,r.jsx)(n.code,{children:"helm uninstall"}),", the PersistentVolumeClaims (PVCs) are not automatically deleted. This is by design to prevent accidental data loss. To fully clean up:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl delete pvc -l app.kubernetes.io/namespace-id=<your-namespace-id>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Single instance only"}),": The bundled persistence deploys single-instance databases with no high availability or automatic failover."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"No automatic backups"}),": You are responsible for implementing backup strategies for the bundled databases."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Docker Hub rate limits"}),": If not using a private registry, you may encounter Docker Hub rate limits during image pulls."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"option-2-external-persistence-production-recommended",children:"Option 2: External Persistence (Production Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"For production deployments, use managed PostgreSQL and S3-compatible storage services for better scalability, reliability, and separation of concerns."}),"\n",(0,r.jsxs)(n.p,{children:["When using external persistence, the bundled persistence layer is disabled by default (",(0,r.jsx)(n.code,{children:"global.persistence.enabled: false"}),")."]}),"\n",(0,r.jsx)(n.h3,{id:"database-requirements",children:"Database Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PostgreSQL version 17 or higher"}),"\n",(0,r.jsxs)(n.li,{children:["Admin credentials with ",(0,r.jsx)(n.code,{children:"SUPERUSER"})," privileges (recommended) or at minimum ",(0,r.jsx)(n.code,{children:"CREATEROLE"})," and ",(0,r.jsx)(n.code,{children:"CREATEDB"})]}),"\n",(0,r.jsx)(n.li,{children:"SAM's init container uses admin credentials to automatically create users and databases for the application and any deployed agents"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"basic-external-configuration",children:"Basic External Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'global:\n  persistence:\n    enabled: false  # Default, can be omitted\n    namespaceId: "my-sam-instance"\n\ndataStores:\n  database:\n    protocol: "postgresql+psycopg2"\n    host: "your-postgres-host"\n    port: "5432"\n    adminUsername: "your-db-admin-user"\n    adminPassword: "your-db-admin-password"\n    applicationPassword: "your-secure-app-password"  # REQUIRED: Password for all app database users\n  s3:\n    endpointUrl: "your-s3-endpoint-url"\n    bucketName: "your-bucket-name"\n    connectorSpecBucketName: "your-connector-specs-bucket-name"\n    accessKey: "your-s3-access-key"\n    secretKey: "your-s3-secret-key"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"}),": The ",(0,r.jsx)(n.code,{children:"applicationPassword"})," field is ",(0,r.jsx)(n.strong,{children:"required"})," when using external persistence. This single password will be used for all database users created by SAM (webui, orchestrator, platform, and all agents)."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Password Rotation Limitation"}),": Once database users are created for a given ",(0,r.jsx)(n.code,{children:"namespaceId"}),", the ",(0,r.jsx)(n.code,{children:"applicationPassword"})," cannot be changed. If you need to change the password, you must either use a new ",(0,r.jsx)(n.code,{children:"namespaceId"})," (which creates new databases and users), or manually update the passwords directly in the database."]}),"\n",(0,r.jsx)(n.h3,{id:"provider-specific-examples",children:"Provider-Specific Examples"}),"\n",(0,r.jsx)(n.h4,{id:"supabase-with-connection-pooler",children:"Supabase with Connection Pooler"}),"\n",(0,r.jsx)(n.p,{children:"If using Supabase with the connection pooler (required for IPv4 networks):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'dataStores:\n  database:\n    protocol: "postgresql+psycopg2"\n    host: "aws-1-us-east-1.pooler.supabase.com"\n    port: "5432"\n    adminUsername: "postgres"\n    adminPassword: "your-supabase-postgres-password"\n    applicationPassword: "your-secure-app-password"\n    supabaseTenantId: "your-project-id"  # Extract from connection string\n  s3:\n    endpointUrl: "https://your-project-id.storage.supabase.co/storage/v1/s3"\n    bucketName: "your-bucket-name"\n    connectorSpecBucketName: "your-connector-specs-bucket-name"\n    accessKey: "your-supabase-s3-access-key"\n    secretKey: "your-supabase-s3-secret-key"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": If using Supabase's Direct Connection with IPv4 addon, omit the ",(0,r.jsx)(n.code,{children:"supabaseTenantId"})," field."]}),"\n",(0,r.jsx)(n.h4,{id:"aws-rds--s3",children:"AWS RDS + S3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'dataStores:\n  database:\n    protocol: "postgresql+psycopg2"\n    host: "mydb.abc123.us-east-1.rds.amazonaws.com"\n    port: "5432"\n    adminUsername: "postgres"\n    adminPassword: "your-rds-password"\n    applicationPassword: "your-secure-app-password"\n  s3:\n    endpointUrl: "https://s3.us-east-1.amazonaws.com"\n    bucketName: "my-sam-artifacts"\n    connectorSpecBucketName: "my-sam-connector-specs"\n    accessKey: "AKIAIOSFODNN7EXAMPLE"\n    secretKey: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"neondb",children:"NeonDB"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'dataStores:\n  database:\n    protocol: "postgresql+psycopg2"\n    host: "ep-cool-name-123456.us-east-2.aws.neon.tech"\n    port: "5432"\n    adminUsername: "neondb_owner"\n    adminPassword: "your-neon-password"\n    applicationPassword: "your-secure-app-password"\n  s3:\n    # Configure your preferred S3-compatible storage\n    endpointUrl: "https://s3.amazonaws.com"\n    bucketName: "my-sam-artifacts"\n    connectorSpecBucketName: "my-sam-connector-specs"\n    accessKey: "your-access-key"\n    secretKey: "your-secret-key"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"aws-s3-bucket-setup-and-policy-requirements",children:"AWS S3 Bucket Setup and Policy Requirements"}),"\n",(0,r.jsxs)(n.p,{children:["When using external AWS S3, you must create ",(0,r.jsx)(n.strong,{children:"both buckets"})," before deploying SAM."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create the buckets:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create artifacts bucket (private)\naws s3 mb s3://your-bucket-name --region us-east-1\n\n# Create connector specs bucket (will configure public read next)\naws s3 mb s3://your-connector-specs-bucket-name --region us-east-1\n"})}),"\n",(0,r.jsx)(n.h4,{id:"connector-specs-bucket-public-read-policy",children:"Connector Specs Bucket: Public Read Policy"}),"\n",(0,r.jsxs)(n.p,{children:["The connector specs bucket ",(0,r.jsx)(n.strong,{children:"requires public read access"})," so agents can download OpenAPI specification files during startup without authentication. This is a critical security requirement that enables the OpenAPI Connector feature."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why public read access?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Agents need to download connector specification files immediately at startup"}),"\n",(0,r.jsx)(n.li,{children:"Authentication credentials are not available to agents until after startup completes"}),"\n",(0,r.jsx)(n.li,{children:"These files contain API schemas and endpoints but no sensitive data (credentials, keys, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"Write access remains restricted to the SAM service only (using S3 access keys)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Security considerations:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Safe to make public"}),": Connector specification files contain only API schemas, endpoints, and data models"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No credentials"}),": Never store API keys, passwords, or secrets in connector specifications"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Write protection"}),": Only the SAM service (with S3 credentials) can upload/modify files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Review specs before upload"}),": Ensure connector specs don't contain internal URLs or sensitive metadata you don't want public"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Apply public read policy:"})}),"\n",(0,r.jsxs)(n.p,{children:["Save this policy as ",(0,r.jsx)(n.code,{children:"connector-specs-policy.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Sid": "PublicReadGetObject",\n    "Effect": "Allow",\n    "Principal": "*",\n    "Action": "s3:GetObject",\n    "Resource": "arn:aws:s3:::your-connector-specs-bucket-name/*"\n  }]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Apply the policy:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws s3api put-bucket-policy \\\n  --bucket your-connector-specs-bucket-name \\\n  --policy file://connector-specs-policy.json\n"})}),"\n",(0,r.jsx)(n.h4,{id:"important-security-notes",children:"Important Security Notes"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Artifacts bucket (private):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Should remain ",(0,r.jsx)(n.strong,{children:"fully private"})," (default AWS S3 behavior)"]}),"\n",(0,r.jsx)(n.li,{children:"No public access policy needed"}),"\n",(0,r.jsx)(n.li,{children:"Contains workflow artifacts and temporary files"}),"\n",(0,r.jsx)(n.li,{children:"Only accessible with S3 credentials"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Connector specs bucket (public read):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Needs ",(0,r.jsx)(n.strong,{children:"public read"})," access (anonymous GetObject)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Private write"})," access (only SAM service with credentials can upload)"]}),"\n",(0,r.jsx)(n.li,{children:"Contains OpenAPI specification files for REST API integrations"}),"\n",(0,r.jsx)(n.li,{children:"Enables the OpenAPI Connector feature"}),"\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"your-connector-specs-bucket-name"})," in the policy with your actual bucket name"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"init-container-stuck-in-pendingcrashloopbackoff",children:"Init Container Stuck in Pending/CrashLoopBackOff"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": The ",(0,r.jsx)(n.code,{children:"agent-mesh-core"})," pod shows init containers waiting or failing."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common causes"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Image pull failures"}),": Check if using GCR registry without specifying GCR-specific image tags"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Storage class issues"}),": Verify the storage class exists and can provision volumes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database connectivity"}),": For external persistence, verify network connectivity to the database"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Debug commands"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check pod status and events\nkubectl describe pod -l app.kubernetes.io/name=solace-agent-mesh\n\n# Check init container logs\nkubectl logs <pod-name> -c init-db-provision\n\n# Verify PVC status\nkubectl get pvc\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pvc-stuck-in-pending",children:"PVC Stuck in Pending"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": PersistentVolumeClaims remain in ",(0,r.jsx)(n.code,{children:"Pending"})," state."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common causes"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"No default storage class configured"}),"\n",(0,r.jsx)(n.li,{children:"Specified storage class doesn't exist"}),"\n",(0,r.jsx)(n.li,{children:"Storage provisioner issues"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Specify an existing storage class explicitly:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'persistence-layer:\n  postgresql:\n    persistence:\n      storageClassName: "your-storage-class"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"docker-hub-rate-limit-errors",children:"Docker Hub Rate Limit Errors"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Image pull errors mentioning rate limits."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Use Solace's private GCR registry (see ",(0,r.jsx)(n.a,{href:"#image-registry-configuration",children:"Image Registry Configuration"}),")."]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);